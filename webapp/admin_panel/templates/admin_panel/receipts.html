<!-- webapp/admin_panel/templates/admin_panel/receipts.html -->
{% extends 'admin_panel/base.html' %}

{% block title %}Cheklar - ISFT Bot{% endblock %}
{% block page_title %}üìã Cheklar{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="fas fa-receipt"></i> To'lov cheklari</h5>
    </div>
    <div class="card-body">
        <!-- Filtrlar -->
        <form method="get" class="row g-3 mb-4">
            <div class="col-md-4">
                <select name="status" class="form-select">
                    <option value="">Barcha statuslar</option>
                    <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>‚è≥ Kutilmoqda</option>
                    <option value="approved" {% if selected_status == 'approved' %}selected{% endif %}>‚úÖ Tasdiqlangan</option>
                    <option value="rejected" {% if selected_status == 'rejected' %}selected{% endif %}>‚ùå Rad etilgan</option>
                </select>
            </div>
            <div class="col-md-4">
                <select name="stage" class="form-select">
                    <option value="">Barcha bosqichlar</option>
                    <option value="1/4" {% if selected_stage == '1/4' %}selected{% endif %}>1/4</option>
                    <option value="2/4" {% if selected_stage == '2/4' %}selected{% endif %}>2/4</option>
                    <option value="3/4" {% if selected_stage == '3/4' %}selected{% endif %}>3/4</option>
                    <option value="4/4" {% if selected_stage == '4/4' %}selected{% endif %}>4/4</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-filter"></i> Filtr
                </button>
            </div>
            <div class="col-md-2">
                <a href="{% url 'admin_panel:receipts_list' %}" class="btn btn-secondary w-100">
                    <i class="fas fa-redo"></i> Tozalash
                </a>
            </div>
        </form>

        <!-- Cheklar jadvali -->
        {% if receipts %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Talaba</th>
                            <th>Talaba ID</th>
                            <th>Bosqich</th>
                            <th>Yuborilgan vaqt</th>
                            <th>Holat</th>
                            <th>Ko'rib chiqdi</th>
                            <th>Amallar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for receipt in receipts %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ receipt.student.full_name }}</td>
                                <td><strong>{{ receipt.student.student_id }}</strong></td>
                                <td>
                                    <span class="badge bg-primary">{{ receipt.payment_schedule.stage }}</span>
                                </td>
                                <td>{{ receipt.submitted_at|date:"d.m.Y H:i" }}</td>
                                <td>
                                    {% if receipt.status == 'pending' %}
                                        <span class="badge bg-warning">‚è≥ Kutilmoqda</span>
                                    {% elif receipt.status == 'approved' %}
                                        <span class="badge bg-success">‚úÖ Tasdiqlangan</span>
                                    {% else %}
                                        <span class="badge bg-danger">‚ùå Rad etilgan</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if receipt.reviewed_by %}
                                        {{ receipt.reviewed_by.get_full_name|default:receipt.reviewed_by.username }}
                                        <br>
                                        <small class="text-muted">{{ receipt.reviewed_at|date:"d.m.Y H:i" }}</small>
                                    {% else %}
                                        <span class="text-muted">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'admin_panel:receipt_review' receipt.id %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye"></i> Ko'rish
                                    </a>
                                    {% if receipt.status == 'pending' %}
                                        <a href="/admin/admin_panel/receipt/{{ receipt.id }}/change/" class="btn btn-sm btn-success">
                                            <i class="fas fa-check"></i>
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> Cheklar topilmadi.
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}